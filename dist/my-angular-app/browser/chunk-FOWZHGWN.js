import{a as v,b as w,e as S,g as O,h as q,i as J,j as K,m as P}from"./chunk-4I3MRSSD.js";import{a as Q}from"./chunk-PCBSMEHG.js";import"./chunk-JPDIGXKX.js";import{$ as Y,Ab as l,Bb as A,Cb as M,Fb as c,Ga as L,Gb as f,Hb as g,Ja as s,Kb as R,Mb as V,Na as m,Sa as _,Tb as x,Wa as b,Ya as F,a as T,aa as W,b as U,cc as j,dc as Z,fc as G,gb as p,gc as h,hb as o,ib as r,jb as z,ka as B,lc as y,ob as H,pb as d,pc as C,q as N,qb as D}from"./chunk-II6X56GS.js";var I=class u{constructor(t){this.http=t}selectedFile;fileCategory="";fileYear;uploadSuccess=new F;onFileSelected(t){this.selectedFile=t.target.files[0]}upload(){if(!this.selectedFile){console.warn("\u05DC\u05D0 \u05E0\u05D1\u05D7\u05E8 \u05E7\u05D5\u05D1\u05E5 \u05DC\u05D4\u05E2\u05DC\u05D0\u05D4.");return}let t=new FormData;t.append("file",this.selectedFile,this.selectedFile.name),this.fileCategory&&t.append("category",this.fileCategory),this.fileYear!==void 0&&t.append("year",this.fileYear.toString()),this.http.post(`${C}/upload`,t,{withCredentials:!0}).subscribe({next:()=>{this.uploadSuccess.emit(),this.resetForm()},error:e=>{console.error("\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D4\u05E2\u05DC\u05D0\u05EA \u05D4\u05E7\u05D5\u05D1\u05E5:",e)}})}resetForm(){this.selectedFile=void 0,this.fileCategory="",this.fileYear=void 0;let t=document.getElementById("fileInput");t&&(t.value="")}static \u0275fac=function(e){return new(e||u)(m(y))};static \u0275cmp=_({type:u,selectors:[["app-file-upload-form"]],outputs:{uploadSuccess:"uploadSuccess"},decls:17,vars:2,consts:[[1,"file-upload-form-container"],[1,"form-title"],[1,"form-group"],["for","fileInput",1,"form-label"],["type","file","id","fileInput",1,"file-input",3,"change"],["for","categoryInput",1,"form-label"],["type","text","id","categoryInput","placeholder","\u05DC\u05D3\u05D5\u05D2\u05DE\u05D4: \u05D3\u05D5\u05D7\u05D5\u05EA, \u05EA\u05DE\u05D5\u05E0\u05D5\u05EA",1,"form-input",3,"ngModelChange","ngModel"],["for","yearInput",1,"form-label"],["type","number","id","yearInput","placeholder","\u05DC\u05D3\u05D5\u05D2\u05DE\u05D4: 2024",1,"form-input",3,"ngModelChange","ngModel"],[1,"upload-button",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"h2",1),l(2,"\u05D4\u05E2\u05DC\u05D0\u05EA \u05E7\u05D5\u05D1\u05E5 \u05D7\u05D3\u05E9"),r(),o(3,"div",2)(4,"label",3),l(5,"\u05D1\u05D7\u05E8 \u05E7\u05D5\u05D1\u05E5:"),r(),o(6,"input",4),d("change",function(n){return i.onFileSelected(n)}),r()(),o(7,"div",2)(8,"label",5),l(9,"\u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D4:"),r(),o(10,"input",6),g("ngModelChange",function(n){return f(i.fileCategory,n)||(i.fileCategory=n),n}),r()(),o(11,"div",2)(12,"label",7),l(13,"\u05E9\u05E0\u05D4:"),r(),o(14,"input",8),g("ngModelChange",function(n){return f(i.fileYear,n)||(i.fileYear=n),n}),r()(),o(15,"button",9),d("click",function(){return i.upload()}),l(16,"\u05D4\u05E2\u05DC\u05D4 \u05E7\u05D5\u05D1\u05E5"),r()()),e&2&&(s(10),c("ngModel",i.fileCategory),s(4),c("ngModel",i.fileYear))},dependencies:[h,P,v,O,w,S],styles:[".file-upload-form-container[_ngcontent-%COMP%]{padding:1rem;border-radius:.5rem;box-shadow:0 4px 6px #0000001a;margin-bottom:1.5rem;background-color:#fff}.form-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#2d3748;margin-bottom:1rem;text-align:center}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{display:block;color:#4a5568;font-size:.875rem;font-weight:700;margin-bottom:.5rem}.form-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;border:1px solid #cbd5e0;border-radius:.375rem;font-size:1rem}.form-input[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #4299e180}.file-input[_ngcontent-%COMP%]{display:block;width:100%;font-size:.875rem;color:#6b7280;cursor:pointer}.file-input[_ngcontent-%COMP%]::file-selector-button{margin-right:1rem;padding:.5rem 1rem;border:none;border-radius:9999px;background-color:#ede9fe;color:#6b46c1;font-weight:600;cursor:pointer;transition:background-color .3s ease-in-out}.file-input[_ngcontent-%COMP%]::file-selector-button:hover{background-color:#ddd6fe}.upload-button[_ngcontent-%COMP%]{width:100%;background-color:#4299e1;color:#fff;font-weight:700;padding:.5rem 1rem;border-radius:9999px;border:none;cursor:pointer;transition:background-color .3s ease-in-out}.upload-button[_ngcontent-%COMP%]:hover{background-color:#3182ce}"]})};function ne(u,t){if(u&1&&(o(0,"span"),l(1),r()),u&2){let e=D().$implicit;s(),M("\u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D4: ",e.category)}}function oe(u,t){if(u&1&&(o(0,"span"),l(1),r()),u&2){let e=D().$implicit;s(),M("\u05E9\u05E0\u05D4: ",e.year)}}function re(u,t){if(u&1&&(o(0,"span"),l(1),R(2,"date"),r()),u&2){let e=D().$implicit;s(),M("\u05EA\u05D0\u05E8\u05D9\u05DA \u05D4\u05E2\u05DC\u05D0\u05D4: ",V(2,1,e.upload_date,"yyyy-MM-dd"))}}function le(u,t){if(u&1){let e=H();o(0,"button",33),d("click",function(){Y(e);let a=D().$implicit,n=D();return W(n.deleteFile(a._id))}),l(1,"\u05DE\u05D7\u05E7"),r()}}function ae(u,t){if(u&1&&(o(0,"li",25)(1,"div",26)(2,"a",27)(3,"span"),l(4),r()(),o(5,"div",28),b(6,ne,2,1,"span",29),l(7," | "),b(8,oe,2,1,"span",29),l(9," | "),b(10,re,3,4,"span",29),l(11,"| "),o(12,"span"),l(13),r()()(),o(14,"div",30)(15,"a",31),l(16,"\u05E6\u05E4\u05D4"),r(),b(17,le,2,0,"button",32),r()()),u&2){let e=t.$implicit,i=D();s(2),p("href",i.apiUrl+e.filename,L),s(2),A(e.filename),s(2),p("ngIf",e.category),s(2),p("ngIf",e.year),s(2),p("ngIf",e.upload_date),s(3),A(i.getUserNameById(e.uploaded_by)),s(2),p("href",i.apiUrl+e.filename,L),s(2),p("ngIf",i.isAdmin)}}function ue(u,t){u&1&&(o(0,"li",34),l(1," \u05D0\u05D9\u05DF \u05E7\u05D1\u05E6\u05D9\u05DD \u05DC\u05D4\u05E6\u05D2\u05D4 \u05D4\u05EA\u05D5\u05D0\u05DE\u05D9\u05DD \u05DC\u05E1\u05D9\u05E0\u05D5\u05DF. "),r())}var k=class u{constructor(t,e,i){this.http=t;this.authService=e;this.cdr=i}allFiles=[];fileDeleted=new F;apiUrl=C+"/files/";displayedFiles=[];filterCategory="";filterYear;sortColumn="upload_date";sortDirection="desc";isAdmin=!1;userMap=new Map;ngOnInit(){this.authService.currentUser$.pipe(N(t=>t?.role==="admin")).subscribe(t=>{this.isAdmin=t}),this.authService.getAllUsers().subscribe({next:t=>{t.forEach(e=>{this.userMap.set(e._id,e.full_name)}),this.cdr.detectChanges()},error:t=>{console.error("\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D8\u05E2\u05D9\u05E0\u05EA \u05E8\u05E9\u05D9\u05DE\u05EA \u05D4\u05DE\u05E9\u05EA\u05DE\u05E9\u05D9\u05DD:",t)}})}getUserNameById(t){return this.userMap.get(t)||"\u05DE\u05E9\u05EA\u05DE\u05E9 \u05DC\u05D0 \u05D9\u05D3\u05D5\u05E2"}ngOnChanges(t){t.allFiles&&this.updateDisplayedFiles()}updateDisplayedFiles(){this.displayedFiles=this.getFilteredAndSortedFiles()}applyFilters(){this.updateDisplayedFiles()}clearFilters(){this.filterCategory="",this.filterYear=void 0,this.updateDisplayedFiles()}applySort(){this.updateDisplayedFiles()}deleteFile(t){confirm("\u05D0\u05EA\u05D4 \u05D1\u05D8\u05D5\u05D7 \u05E9\u05D0\u05EA\u05D4 \u05E8\u05D5\u05E6\u05D4 \u05DC\u05DE\u05D7\u05D5\u05E7 \u05D0\u05EA \u05D4\u05E7\u05D5\u05D1\u05E5?")&&this.http.delete(`${C}/files/${t}`,{withCredentials:!0}).subscribe({next:()=>{alert("\u05D4\u05E7\u05D5\u05D1\u05E5 \u05E0\u05DE\u05D7\u05E7 \u05D1\u05D4\u05E6\u05DC\u05D7\u05D4!"),this.allFiles=this.allFiles.filter(e=>e._id!==t),this.updateDisplayedFiles(),this.fileDeleted.emit(t)},error:e=>{console.error("\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05DE\u05D7\u05D9\u05E7\u05EA \u05D4\u05E7\u05D5\u05D1\u05E5:",e)}})}getFilteredAndSortedFiles(){let t=[...this.allFiles];return this.filterCategory&&(t=t.filter(e=>e.category&&e.category.toLowerCase().includes(this.filterCategory.toLowerCase()))),this.filterYear!==void 0&&this.filterYear!==null&&(t=t.filter(e=>e.year&&e.year===this.filterYear)),this.sortColumn&&t.sort((e,i)=>{let a=e[this.sortColumn],n=i[this.sortColumn];a==null&&(a=""),n==null&&(n=""),this.sortColumn==="upload_date"?(a=a?new Date(a).getTime():0,n=n?new Date(n).getTime():0):this.sortColumn==="year"?(a=a||0,n=n||0):typeof a=="string"&&typeof n=="string"&&(a=a.toLowerCase(),n=n.toLowerCase());let E=0;return a>n?E=1:a<n&&(E=-1),this.sortDirection==="desc"?E*-1:E}),t}static \u0275fac=function(e){return new(e||u)(m(y),m(Q),m(x))};static \u0275cmp=_({type:u,selectors:[["app-file-list-display"]],inputs:{allFiles:"allFiles"},outputs:{fileDeleted:"fileDeleted"},features:[B],decls:44,vars:6,consts:[[1,"file-filter-container"],[1,"filter-title"],[1,"filter-section"],[1,"filter-group"],["for","filterCategoryInput",1,"filter-label"],["type","text","id","filterCategoryInput","placeholder","\u05DB\u05DC \u05D4\u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D5\u05EA",1,"filter-input",3,"ngModelChange","ngModel"],["for","filterYearInput",1,"filter-label"],["type","number","id","filterYearInput","placeholder","\u05DB\u05DC \u05D4\u05E9\u05E0\u05D9\u05DD",1,"filter-input",3,"ngModelChange","ngModel"],[1,"filter-button","apply-button",3,"click"],[1,"filter-button","clear-button",3,"click"],[1,"sort-section"],["for","sortColumn",1,"filter-label"],["id","sortColumn",1,"filter-input",3,"ngModelChange","ngModel"],["value","upload_date"],["value","filename"],["value","category"],["value","year"],["for","sortDirection",1,"filter-label"],["id","sortDirection",1,"filter-input",3,"ngModelChange","ngModel"],["value","asc"],["value","desc"],[1,"filter-button","sort-button",3,"click"],[1,"file-list"],["class","file-item",4,"ngFor","ngForOf"],["class","empty-message",4,"ngIf"],[1,"file-item"],[1,"file-details"],["target","_blank",1,"file-link",3,"href"],[1,"file-meta"],[4,"ngIf"],[1,"file-actions"],["target","_blank",1,"action-button","view-button",3,"href"],["class","action-button delete-button",3,"click",4,"ngIf"],[1,"action-button","delete-button",3,"click"],[1,"empty-message"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"h3",1),l(2,"\u05E1\u05D9\u05E0\u05D5\u05DF \u05D5\u05DE\u05D9\u05D5\u05DF \u05E7\u05D1\u05E6\u05D9\u05DD"),r(),o(3,"div",2)(4,"div",3)(5,"label",4),l(6,"\u05E1\u05E0\u05DF \u05DC\u05E4\u05D9 \u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D4:"),r(),o(7,"input",5),g("ngModelChange",function(n){return f(i.filterCategory,n)||(i.filterCategory=n),n}),r()(),o(8,"div",3)(9,"label",6),l(10,"\u05E1\u05E0\u05DF \u05DC\u05E4\u05D9 \u05E9\u05E0\u05D4:"),r(),o(11,"input",7),g("ngModelChange",function(n){return f(i.filterYear,n)||(i.filterYear=n),n}),r()(),o(12,"button",8),d("click",function(){return i.applyFilters()}),l(13,"\u05E1\u05E0\u05DF"),r(),o(14,"button",9),d("click",function(){return i.clearFilters()}),l(15,"\u05E0\u05E7\u05D4 \u05E1\u05D9\u05E0\u05D5\u05DF"),r()(),o(16,"div",10)(17,"div",3)(18,"label",11),l(19,"\u05DE\u05D9\u05D9\u05DF \u05DC\u05E4\u05D9:"),r(),o(20,"select",12),g("ngModelChange",function(n){return f(i.sortColumn,n)||(i.sortColumn=n),n}),o(21,"option",13),l(22,"\u05EA\u05D0\u05E8\u05D9\u05DA \u05D4\u05E2\u05DC\u05D0\u05D4"),r(),o(23,"option",14),l(24,"\u05E9\u05DD \u05E7\u05D5\u05D1\u05E5"),r(),o(25,"option",15),l(26,"\u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D4"),r(),o(27,"option",16),l(28,"\u05E9\u05E0\u05D4"),r()()(),o(29,"div",3)(30,"label",17),l(31,"\u05DB\u05D9\u05D5\u05D5\u05DF \u05DE\u05D9\u05D5\u05DF:"),r(),o(32,"select",18),g("ngModelChange",function(n){return f(i.sortDirection,n)||(i.sortDirection=n),n}),o(33,"option",19),l(34,"\u05E2\u05D5\u05DC\u05D4 (A-Z, 1-9)"),r(),o(35,"option",20),l(36,"\u05D9\u05D5\u05E8\u05D3 (Z-A, 9-1)"),r()()(),o(37,"button",21),d("click",function(){return i.applySort()}),l(38,"\u05DE\u05D9\u05D9\u05DF"),r()(),o(39,"h3",1),l(40,"\u05E8\u05E9\u05D9\u05DE\u05EA \u05E7\u05D1\u05E6\u05D9\u05DD"),r(),o(41,"ul",22),b(42,ae,18,8,"li",23)(43,ue,2,0,"li",24),r()()),e&2&&(s(7),c("ngModel",i.filterCategory),s(4),c("ngModel",i.filterYear),s(9),c("ngModel",i.sortColumn),s(12),c("ngModel",i.sortDirection),s(10),p("ngForOf",i.displayedFiles),s(),p("ngIf",i.displayedFiles.length===0))},dependencies:[h,j,Z,P,J,K,v,O,q,w,S,G],styles:[".file-filter-container[_ngcontent-%COMP%]{padding:1.5rem;border-radius:1rem;box-shadow:0 4px 10px #00000014;background-color:#fff;transition:box-shadow .3s ease-in-out}.file-filter-container[_ngcontent-%COMP%]:hover{box-shadow:0 6px 14px #0000001a}.filter-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#2d3748;margin-bottom:1.5rem;text-align:center}.filter-section[_ngcontent-%COMP%], .sort-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:2rem}@media (min-width: 640px){.filter-section[_ngcontent-%COMP%], .sort-section[_ngcontent-%COMP%]{flex-direction:row}}.filter-group[_ngcontent-%COMP%]{flex-grow:1}.filter-label[_ngcontent-%COMP%]{display:block;color:#4a5568;font-size:.875rem;font-weight:700;margin-bottom:.5rem}.filter-input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;border:1px solid #cbd5e0;border-radius:.375rem;font-size:1rem;transition:border-color .3s ease-in-out,box-shadow .3s ease-in-out}.filter-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4299e1;box-shadow:0 0 0 3px #4299e180}.filter-button[_ngcontent-%COMP%]{font-weight:700;padding:.5rem 1rem;border-radius:9999px;border:none;cursor:pointer;transition:background-color .3s ease-in-out,transform .2s ease;width:100%}.filter-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}@media (min-width: 640px){.filter-button[_ngcontent-%COMP%]{width:auto}}.apply-button[_ngcontent-%COMP%]{background-color:#805ad5;color:#fff}.apply-button[_ngcontent-%COMP%]:hover{background-color:#6b46c1}.clear-button[_ngcontent-%COMP%]{background-color:#718096;color:#fff}.clear-button[_ngcontent-%COMP%]:hover{background-color:#4a5568}.sort-button[_ngcontent-%COMP%]{background-color:#4299e1;color:#fff}.sort-button[_ngcontent-%COMP%]:hover{background-color:#3182ce}.file-list[_ngcontent-%COMP%]{max-height:30rem;overflow:auto;list-style:none;padding:0}.file-item[_ngcontent-%COMP%]{padding:1rem;margin-bottom:.75rem;border-radius:.75rem;box-shadow:0 2px 6px #0000000d;border:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;transition:box-shadow .3s ease-in-out,transform .2s ease}.file-item[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #0000001a;transform:translateY(-2px)}.file-details[_ngcontent-%COMP%]{flex-grow:1;text-align:right}.file-link[_ngcontent-%COMP%]{color:#3182ce;font-size:1.125rem;font-weight:500;text-decoration:none;display:block;word-break:break-word}.file-link[_ngcontent-%COMP%]:hover{color:#2b6cb0}.file-meta[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;color:#718096;font-size:.875rem;margin-top:.25rem;gap:.5rem}.file-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.action-button[_ngcontent-%COMP%]{font-weight:700;padding:.25rem .75rem;border-radius:9999px;font-size:.75rem;cursor:pointer;text-decoration:none;color:#fff;transition:background-color .3s ease-in-out,transform .2s ease}.action-button[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.view-button[_ngcontent-%COMP%]{background-color:#48bb78}.view-button[_ngcontent-%COMP%]:hover{background-color:#38a169}.delete-button[_ngcontent-%COMP%]{background-color:#e53e3e}.delete-button[_ngcontent-%COMP%]:hover{background-color:#c53030}.empty-message[_ngcontent-%COMP%]{text-align:center;color:#a0aec0;padding:1rem;font-size:1rem;transition:color .3s ease-in-out}"]})};var te=class u{constructor(t,e){this.http=t;this.cdr=e}allFiles=[];ngOnInit(){this.fetchFiles()}fetchFiles(){let t=`${C}/files`;this.http.get(t,{withCredentials:!0}).subscribe({next:e=>{this.allFiles=e.map(i=>U(T({},i),{upload_date:i.upload_date?new Date(i.upload_date):null})),this.cdr.detectChanges()},error:e=>{console.error("\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D8\u05E2\u05D9\u05E0\u05EA \u05E8\u05E9\u05D9\u05DE\u05EA \u05D4\u05E7\u05D1\u05E6\u05D9\u05DD \u05D1\u05E7\u05D5\u05DE\u05E4\u05D5\u05E0\u05E0\u05D8\u05EA \u05D4\u05D0\u05D1:",e),this.allFiles=[]}})}onUploadSuccess(){this.fetchFiles()}onFileDeleted(t){this.fetchFiles()}static \u0275fac=function(e){return new(e||u)(m(y),m(x))};static \u0275cmp=_({type:u,selectors:[["app-file-manager"]],decls:4,vars:1,consts:[[1,"file-management-container"],[3,"fileDeleted","allFiles"],[1,"separator"],[3,"uploadSuccess"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"app-file-list-display",1),d("fileDeleted",function(n){return i.onFileDeleted(n)}),r(),z(2,"hr",2),o(3,"app-file-upload-form",3),d("uploadSuccess",function(){return i.onUploadSuccess()}),r()()),e&2&&(s(),p("allFiles",i.allFiles))},dependencies:[h,I,k],styles:[".file-management-container[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#f7fafc;border-radius:.5rem;box-shadow:0 4px 6px #0000001a;max-width:40rem;margin-left:auto;margin-right:auto;font-family:Inter,sans-serif}.separator[_ngcontent-%COMP%]{margin:2rem 0;border:none;border-top:1px solid #d1d5db}"]})};export{te as FileManagerComponent};
