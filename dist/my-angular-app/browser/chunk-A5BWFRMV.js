import{a as $}from"./chunk-RUHH6DTZ.js";import{$ as U,$b as T,Eb as F,Fa as f,Gb as R,Ia as o,Ma as s,Nb as I,Q as P,Ra as h,U as M,Va as c,Xa as w,Yb as z,Zb as _,aa as S,ac as C,cb as m,db as n,eb as r,fb as v,gc as b,ib as k,jb as p,kb as d,kc as g,q as O,ub as l,vb as u,wb as A}from"./chunk-VO2ANZID.js";function V(i,t){i&1&&(n(0,"div",7),l(1,"\u05DE\u05E2\u05DC\u05D4 \u05EA\u05DE\u05D5\u05E0\u05D4..."),r())}function B(i,t){if(i&1&&(n(0,"div",8),l(1),r()),i&2){let e=d();o(),u(e.uploadError)}}function q(i,t){if(i&1&&(n(0,"div",9),l(1," \u05D4\u05EA\u05DE\u05D5\u05E0\u05D4 \u05D4\u05D5\u05E2\u05DC\u05EA\u05D4 \u05D1\u05D4\u05E6\u05DC\u05D7\u05D4: "),n(2,"a",10),l(3),r()()),i&2){let e=d();o(2),m("href",e.uploadedImageUrl,f),o(),u(e.uploadedImageUrl)}}var D=class i{constructor(t,e){this.http=t;this.cdr=e}selectedFile;uploading=!1;uploadError="";uploadedImageUrl="";imageUploaded=new w;onFileSelected(t){this.selectedFile=t.target.files[0],this.uploadedImageUrl="",this.uploadError=""}uploadImage(){if(!this.selectedFile){this.uploadError="\u05D0\u05E0\u05D0 \u05D1\u05D7\u05E8 \u05E7\u05D5\u05D1\u05E5 \u05EA\u05DE\u05D5\u05E0\u05D4 \u05DC\u05D4\u05E2\u05DC\u05D0\u05D4.";return}this.uploading=!0,this.uploadError="";let t=new FormData;t.append("file",this.selectedFile,this.selectedFile.name),this.http.post(`${g}/images`,t,{withCredentials:!0}).subscribe({next:e=>{this.uploading=!1,this.uploadedImageUrl=`${g}${e.url}`,this.imageUploaded.emit({url:this.uploadedImageUrl,id:e._id,filename:e.filename}),this.selectedFile=void 0,this.cdr.detectChanges()},error:e=>{this.uploading=!1,this.uploadError=e.error?.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D4\u05E2\u05DC\u05D0\u05EA \u05D4\u05EA\u05DE\u05D5\u05E0\u05D4.",console.error("Image upload error:",e)}})}static \u0275fac=function(e){return new(e||i)(s(b),s(I))};static \u0275cmp=h({type:i,selectors:[["app-image-uploader"]],outputs:{imageUploaded:"imageUploaded"},decls:9,vars:3,consts:[[1,"image-upload-container"],[1,"upload-title"],["type","file","accept","image/*",1,"file-input",3,"change"],[1,"upload-button",3,"click"],["class","uploading-message",4,"ngIf"],["class","upload-error",4,"ngIf"],["class","upload-success",4,"ngIf"],[1,"uploading-message"],[1,"upload-error"],[1,"upload-success"],["target","_blank",1,"upload-link",3,"href"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h3",1),l(2," \u05D4\u05D5\u05E1\u05E4\u05EA \u05EA\u05DE\u05D5\u05E0\u05D4 \u05DC\u05E7\u05E8\u05D5\u05E1\u05DC\u05D4"),r(),n(3,"input",2),p("change",function(y){return a.onFileSelected(y)}),r(),n(4,"button",3),p("click",function(){return a.uploadImage()}),l(5,"\u05D4\u05E2\u05DC\u05D4 \u05EA\u05DE\u05D5\u05E0\u05D4"),r(),c(6,V,2,0,"div",4)(7,B,2,1,"div",5)(8,q,4,2,"div",6),r()),e&2&&(o(6),m("ngIf",a.uploading),o(),m("ngIf",a.uploadError),o(),m("ngIf",a.uploadedImageUrl))},dependencies:[C,_],styles:[".image-upload-container[_ngcontent-%COMP%]{padding:1rem;background-color:#f9fafb;border-radius:.5rem;border:1px solid #e5e7eb}.upload-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#2d3748;margin-bottom:.75rem}.file-input[_ngcontent-%COMP%]{display:block;width:100%;font-size:.875rem;color:#6b7280;cursor:pointer}.file-input[_ngcontent-%COMP%]::file-selector-button{margin-right:1rem;padding:.5rem 1rem;border:none;border-radius:9999px;background-color:#eef2ff;color:#4338ca;font-size:.875rem;font-weight:600;cursor:pointer;transition:background-color .3s ease-in-out}.file-input[_ngcontent-%COMP%]::file-selector-button:hover{background-color:#e0e7ff}.upload-button[_ngcontent-%COMP%]{margin-top:.75rem;background-color:#4f46e5;color:#fff;font-weight:700;padding:.5rem 1rem;border-radius:9999px;font-size:.875rem;border:none;cursor:pointer;transition:background-color .3s ease-in-out}.upload-button[_ngcontent-%COMP%]:hover{background-color:#4338ca}.uploading-message[_ngcontent-%COMP%]{font-size:.875rem;color:#4b5563;margin-top:.5rem}.upload-error[_ngcontent-%COMP%]{font-size:.875rem;color:#f56565;margin-top:.5rem}.upload-success[_ngcontent-%COMP%]{font-size:.875rem;color:#38a169;margin-top:.5rem}.upload-link[_ngcontent-%COMP%]{color:#3b82f6;text-decoration:none}.upload-link[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})};var E=class i{constructor(t){this.http=t}apiUrl=g+"/images";getUploadedImages(){return this.http.get(this.apiUrl,{withCredentials:!0})}deleteImageRecord(t){return this.http.delete(`${this.apiUrl}/${t}`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||i)(M(b))};static \u0275prov=P({token:i,factory:i.\u0275fac,providedIn:"root"})};function K(i,t){i&1&&(n(0,"div",7),l(1,"\u05D8\u05D5\u05E2\u05DF \u05EA\u05DE\u05D5\u05E0\u05D5\u05EA..."),r())}function Q(i,t){if(i&1&&(n(0,"div",8),l(1),r()),i&2){let e=d();o(),u(e.error)}}function W(i,t){if(i&1){let e=k();n(0,"button",15),p("click",function(){U(e);let x=d().$implicit,y=d();return S(y.deleteImage(x._id))}),l(1,"\u05DE\u05D7\u05E7"),r()}}function X(i,t){if(i&1&&(n(0,"div",9),v(1,"img",10),n(2,"div",11),l(3),v(4,"br"),n(5,"span",12),l(6),F(7,"date"),r()(),n(8,"div",13),c(9,W,2,0,"button",14),r()()),i&2){let e=t.$implicit,a=d();o(),m("src",a.getFullImageUrl(e.url),f)("alt",e.filename),o(2),A(" ",e.filename),o(3),u(R(7,5,e.uploaded_at,"short")),o(3),m("ngIf",a.isAdmin)}}function Y(i,t){i&1&&(n(0,"div",16),l(1," \u05E2\u05D3\u05D9\u05D9\u05DF \u05DC\u05D0 \u05D4\u05D5\u05E2\u05DC\u05D5 \u05EA\u05DE\u05D5\u05E0\u05D5\u05EA. "),r())}var G=class i{constructor(t,e,a){this.imageService=t;this.authService=e;this.cdr=a}images=[];loading=!0;error="";isAdmin=!1;ngOnInit(){this.fetchImages(),this.authService.currentUser$.pipe(O(t=>t?.role==="admin"||t?.role==="member")).subscribe(t=>{this.isAdmin=t})}fetchImages(){this.loading=!0,this.error="",this.imageService.getUploadedImages().subscribe({next:t=>{this.images=t,this.preloadImages(),this.loading=!1,this.cdr.detectChanges()},error:t=>{this.error="\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D8\u05E2\u05D9\u05E0\u05EA \u05D4\u05EA\u05DE\u05D5\u05E0\u05D5\u05EA.",this.loading=!1,console.error("Error fetching images:",t),this.cdr.detectChanges()}})}getFullImageUrl(t){return`${g}${t}`}preloadImages(){this.images.forEach(t=>{let e=new Image;e.src=this.getFullImageUrl(t.url)})}deleteImage(t){confirm("\u05D4\u05D0\u05DD \u05D0\u05EA\u05D4 \u05D1\u05D8\u05D5\u05D7 \u05E9\u05D1\u05E8\u05E6\u05D5\u05E0\u05DA \u05DC\u05DE\u05D7\u05D5\u05E7 \u05EA\u05DE\u05D5\u05E0\u05D4 \u05D6\u05D5? \u05E4\u05E2\u05D5\u05DC\u05D4 \u05D6\u05D5 \u05D1\u05DC\u05EA\u05D9 \u05D4\u05E4\u05D9\u05DB\u05D4!")&&this.imageService.deleteImageRecord(t).subscribe({next:()=>{this.fetchImages()},error:e=>{this.error=e.error?.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05DE\u05D7\u05D9\u05E7\u05EA \u05D4\u05EA\u05DE\u05D5\u05E0\u05D4.",console.error("Error deleting image:",e),e.status===403?alert("\u05D0\u05D9\u05DF \u05DC\u05DA \u05D4\u05E8\u05E9\u05D0\u05D4 \u05DC\u05DE\u05D7\u05D5\u05E7 \u05EA\u05DE\u05D5\u05E0\u05D4 \u05D6\u05D5. \u05E8\u05E7 \u05DC\u05DE\u05E0\u05D4\u05DC\u05D9\u05DD \u05DE\u05D5\u05EA\u05E8."):e.status===404&&alert("\u05D4\u05EA\u05DE\u05D5\u05E0\u05D4 \u05DC\u05D0 \u05E0\u05DE\u05E6\u05D0\u05D4 \u05D1\u05E9\u05E8\u05EA.")}})}static \u0275fac=function(e){return new(e||i)(s(E),s($),s(I))};static \u0275cmp=h({type:i,selectors:[["app-image-gallery"]],decls:9,vars:4,consts:[[1,"image-gallery-container"],[1,"gallery-title"],["class","loading-message",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"image-grid"],["class","image-card",4,"ngFor","ngForOf"],["class","empty-message",4,"ngIf"],[1,"loading-message"],[1,"error-message"],[1,"image-card"],[1,"image-preview",3,"src","alt"],[1,"image-info"],[1,"upload-date"],[1,"image-actions"],["class","delete-button",3,"click",4,"ngIf"],[1,"delete-button",3,"click"],[1,"empty-message"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2",1),l(2,"\u05D2\u05DC\u05E8\u05D9\u05D9\u05EA \u05EA\u05DE\u05D5\u05E0\u05D5\u05EA "),r(),c(3,K,2,0,"div",2)(4,Q,2,1,"div",3),n(5,"div",4),c(6,X,10,8,"div",5),r(),c(7,Y,2,0,"div",6),v(8,"app-image-uploader"),r()),e&2&&(o(3),m("ngIf",a.loading),o(),m("ngIf",a.error),o(2),m("ngForOf",a.images),o(),m("ngIf",!a.loading&&a.images.length===0))},dependencies:[C,z,_,T,D],styles:[".image-gallery-container[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#f7fafc;border-radius:.5rem;box-shadow:0 4px 6px #0000001a;max-width:42rem;margin-left:auto;margin-right:auto;font-family:Inter,sans-serif}.gallery-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#2d3748;margin-bottom:1rem;text-align:center}.loading-message[_ngcontent-%COMP%], .error-message[_ngcontent-%COMP%], .empty-message[_ngcontent-%COMP%]{text-align:center;font-size:1rem;padding:1rem}.loading-message[_ngcontent-%COMP%]{color:#4a5568}.error-message[_ngcontent-%COMP%]{color:#f56565}.empty-message[_ngcontent-%COMP%]{color:#a0aec0}.image-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:.75rem}@media (min-width: 768px){.image-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}.image-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e2e8f0;border-radius:.5rem;box-shadow:0 2px 4px #0000000d;overflow:hidden}.image-preview[_ngcontent-%COMP%]{width:100%;height:8rem;object-fit:cover}.image-info[_ngcontent-%COMP%]{padding:.5rem;text-align:center;font-size:.875rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.upload-date[_ngcontent-%COMP%]{color:#a0aec0;font-size:.75rem}.image-actions[_ngcontent-%COMP%]{padding:.5rem;text-align:center}.delete-button[_ngcontent-%COMP%]{background-color:#e53e3e;color:#fff;font-size:.75rem;padding:.25rem .5rem;border:none;border-radius:9999px;cursor:pointer;transition:background-color .3s ease-in-out}.delete-button[_ngcontent-%COMP%]:hover{background-color:#c53030}"]})};export{G as a};
