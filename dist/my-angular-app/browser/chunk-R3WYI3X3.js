import{h as v}from"./chunk-M2AP7PFC.js";import{C as h,L as c,N as a,Q as b,U as n,gc as g,j as i,kc as o,m as l,n as u,q as p,y as r}from"./chunk-NERK7KHH.js";var m=class s{constructor(t,e){this.http=t;this.router=e;this.checkInitialAuthStatus().pipe(h(1)).subscribe()}apiUrl=o+"/auth";currentUserSubject=new i(null);currentUser$=this.currentUserSubject.asObservable();_isLoggedIn=new i(!1);isLoggedIn$=this._isLoggedIn.asObservable();checkInitialAuthStatus(){return this.http.get(`${this.apiUrl}/me`,{withCredentials:!0}).pipe(a(t=>{this.currentUserSubject.next(t),this._isLoggedIn.next(!0)}),r(t=>(this.currentUserSubject.next(null),this._isLoggedIn.next(!1),(t.status===401||t.status===403)&&this.router.url!=="/login"&&this.router.navigate(["/login"]),l(null))))}login(t){let e={email:t.email,password:t.password};return this.http.post(`${this.apiUrl}/login`,e,{headers:{"Content-Type":"application/json"},withCredentials:!0}).pipe(c(()=>this.checkInitialAuthStatus()),p(d=>d),r(this.handleError))}register(t){return this.http.post(`${this.apiUrl}/register`,t,{withCredentials:!0}).pipe(r(this.handleError))}logout(){return this.http.post(`${this.apiUrl}/logout`,{},{withCredentials:!0}).pipe(a(()=>{this.currentUserSubject.next(null),this._isLoggedIn.next(!1),this.router.navigate(["/login"])}),r(this.handleError))}handleError(t){let e="An unknown error occurred!";return t.error instanceof ErrorEvent?e=`Error: ${t.error.message}`:e=`Error Code: ${t.status}
Message: ${t.error?.message||t.statusText}`,console.error("AuthService: HTTP Error:",e,t),u(()=>new Error(e))}getAllUsers(){return this.http.get(`${o}/users`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||s)(n(g),n(v))};static \u0275prov=b({token:s,factory:s.\u0275fac,providedIn:"root"})};export{m as a};
