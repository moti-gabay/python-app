import{a as L,b as N,e as R,g as z,k as H,m as F}from"./chunk-647I7AV7.js";import{a as $}from"./chunk-RUHH6DTZ.js";import"./chunk-22BB62GF.js";import{$ as d,Ab as k,Bb as V,C as E,Ia as s,Ma as m,Q as h,Ra as C,U as b,Va as x,Zb as U,aa as c,ac as T,cb as v,db as o,eb as i,fb as f,gc as j,ib as P,jb as _,kb as w,kc as Q,n as D,ob as S,pb as A,qb as M,sb as I,ub as u,wb as B,y,zb as O}from"./chunk-VO2ANZID.js";var g={production:!1,apiUrl:"http://localhost:5000",paypalClientId:"AdQFE3i1VoV0rY2ixii0TSRJkZ3NQJUxjpX3TLNqbqsOYi51Cph4vdEgUBjRMgksiCNAW1KaIirZqdgR"};var p=class r{constructor(t){this.http=t}apiUrl=Q+"/api";sendDonationConfirmationEmail(t){return this.http.post(`${this.apiUrl}/send-donation-confirmation`,t,{withCredentials:!0}).pipe(y(this.handleError))}handleError(t){let n="An unknown error occurred!";return t.error instanceof ErrorEvent?n=`Client-side error: ${t.error.message}`:n=`Server-side error: ${t.status}
Message: ${t.error?.message||t.statusText}`,console.error("DonationService: HTTP Error:",n,t),D(()=>new Error(n))}static \u0275fac=function(n){return new(n||r)(b(j))};static \u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})};var J=["paypalButtonContainer"];function Z(r,t){if(r&1&&(o(0,"div",15),u(1),i()),r&2){let n=w();I("success",n.donationStatus.includes("\u05EA\u05D5\u05D3\u05D4"))("error",n.donationStatus.includes("\u05E9\u05D2\u05D9\u05D0\u05D4")||n.donationStatus.includes("\u05D1\u05D5\u05D8\u05DC\u05D4")),s(),B(" ",n.donationStatus," ")}}var q=class r{constructor(t,n){this.donationService=t;this.authService=n}paypalButtonContainer;donationAmount=10;donationStatus="";currentUserEmail="";ngOnInit(){this.loadPayPalScript(),this.authService.currentUser$.pipe(E(1)).subscribe(t=>{t&&t.email&&(this.currentUserEmail=t.email)})}ngAfterViewInit(){if(typeof paypal<"u")this.renderPayPalButton();else{let t=document.getElementById("paypal-sdk");t&&(t.onload=()=>{this.renderPayPalButton()})}}loadPayPalScript(){if(document.getElementById("paypal-sdk"))return;let t=document.createElement("script");t.id="paypal-sdk",t.src=`https://www.paypal.com/sdk/js?client-id=${g.paypalClientId}&currency=ILS&disable-funding=credit,card`,t.onload=()=>{this.paypalButtonContainer&&typeof paypal<"u"&&this.renderPayPalButton()},t.onerror=n=>{console.error("Failed to load PayPal SDK:",n),this.donationStatus="\u05D0\u05D9\u05E8\u05E2\u05D4 \u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D8\u05E2\u05D9\u05E0\u05EA \u05DB\u05E4\u05EA\u05D5\u05E8 \u05D4\u05EA\u05E8\u05D5\u05DE\u05D4. \u05E0\u05E1\u05D4 \u05DC\u05E8\u05E2\u05E0\u05DF \u05D0\u05EA \u05D4\u05D3\u05E3."},document.body.appendChild(t)}renderPayPalButton(){if(!this.paypalButtonContainer||!paypal){console.warn("PayPal button container not found or PayPal SDK not ready.");return}this.paypalButtonContainer.nativeElement.innerHTML="",paypal.Buttons({env:g.production?"production":"sandbox",createOrder:(t,n)=>n.order.create({purchase_units:[{amount:{value:this.donationAmount.toFixed(2),currency_code:"ILS"}}]}),onApprove:(t,n)=>n.order.capture().then(e=>{this.donationStatus=`\u05EA\u05D5\u05D3\u05D4 \u05E8\u05D1\u05D4 \u05E2\u05DC \u05EA\u05E8\u05D5\u05DE\u05EA\u05DA \u05D1\u05E1\u05DA ${this.donationAmount} ILS, ${e.payer.name.given_name}!`,this.currentUserEmail?this.donationService.sendDonationConfirmationEmail({recipient_email:this.currentUserEmail,payer_name:e.payer.name.given_name||"\u05EA\u05D5\u05E8\u05DD \u05D9\u05E7\u05E8",amount:this.donationAmount,currency:"ILS",transaction_id:e.id}).subscribe({next:a=>console.log("Email send request successful:",a),error:a=>console.error("Failed to send email confirmation:",a)}):console.warn("Cannot send confirmation email: User email not available.")}).catch(e=>{console.error("Error capturing order:",e),this.donationStatus="\u05D0\u05D9\u05E8\u05E2\u05D4 \u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05EA\u05D4\u05DC\u05D9\u05DA \u05D4\u05EA\u05E8\u05D5\u05DE\u05D4. \u05D0\u05E0\u05D0 \u05E0\u05E1\u05D4 \u05E9\u05D5\u05D1."}),onCancel:t=>{this.donationStatus="\u05D4\u05EA\u05E8\u05D5\u05DE\u05D4 \u05D1\u05D5\u05D8\u05DC\u05D4."},onError:t=>{console.error("PayPal button error:",t),this.donationStatus="\u05D0\u05D9\u05E8\u05E2\u05D4 \u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05DB\u05E4\u05EA\u05D5\u05E8 \u05D4\u05EA\u05E8\u05D5\u05DE\u05D4. \u05D0\u05E0\u05D0 \u05E0\u05E1\u05D4 \u05E9\u05D5\u05D1 \u05DE\u05D0\u05D5\u05D7\u05E8 \u05D9\u05D5\u05EA\u05E8."}}).render(this.paypalButtonContainer.nativeElement)}onAmountChange(){this.donationAmount>0&&typeof paypal<"u"&&this.paypalButtonContainer&&this.renderPayPalButton()}static \u0275fac=function(n){return new(n||r)(m(p),m($))};static \u0275cmp=C({type:r,selectors:[["app-donation"]],viewQuery:function(n,e){if(n&1&&S(J,7),n&2){let a;A(a=M())&&(e.paypalButtonContainer=a.first)}},decls:24,vars:2,consts:[["paypalButtonContainer",""],[1,"donation-container"],[1,"donation-title"],[1,"donation-description"],[1,"form-group"],["for","donationAmount",1,"form-label"],["type","number","id","donationAmount","min","1","step","1",1,"form-input",3,"ngModelChange","ngModel"],[1,"paypal-button-wrapper"],[1,"paybox-link-wrapper"],[1,"paybox-text"],["href","https://link.payboxapp.com/HPNEdc74wRY54Vsx6","target","_blank","rel","noopener noreferrer",1,"paybox-button"],["src","https://www.payboxapp.com/wp-content/uploads/2020/04/site-logo-white.png","alt","\u05DC\u05D5\u05D2\u05D5 PayBox",1,"paybox-logo"],["class","donation-status",3,"success","error",4,"ngIf"],[1,"security-note"],[1,"security-icon"],[1,"donation-status"]],template:function(n,e){if(n&1){let a=P();o(0,"div",1)(1,"h2",2),u(2,"\u05EA\u05E8\u05D5\u05DE\u05D4 \u05DC\u05D0\u05EA\u05E8"),i(),o(3,"p",3),u(4," \u05EA\u05E8\u05D5\u05DE\u05EA\u05DA \u05E2\u05D5\u05D6\u05E8\u05EA \u05DC\u05E0\u05D5 \u05DC\u05D4\u05DE\u05E9\u05D9\u05DA \u05D5\u05DC\u05E1\u05E4\u05E7 \u05EA\u05D5\u05DB\u05DF \u05D5\u05E9\u05D9\u05E8\u05D5\u05EA\u05D9\u05DD \u05D0\u05D9\u05DB\u05D5\u05EA\u05D9\u05D9\u05DD. "),i(),o(5,"div",4)(6,"label",5),u(7,"\u05E1\u05DB\u05D5\u05DD \u05D4\u05EA\u05E8\u05D5\u05DE\u05D4 (ILS):"),i(),o(8,"input",6),V("ngModelChange",function(l){return d(a),k(e.donationAmount,l)||(e.donationAmount=l),c(l)}),_("ngModelChange",function(){return d(a),c(e.onAmountChange())}),i()(),f(9,"div",7,0),o(11,"div",8)(12,"p",9),u(13,"\u05D0\u05D5 \u05EA\u05E8\u05DE\u05D5 \u05D3\u05E8\u05DA PayBox:"),i(),o(14,"a",10),f(15,"img",11),o(16,"span"),u(17,"\u05EA\u05E8\u05D5\u05DE\u05D4 \u05D1-PayBox"),i()()(),x(18,Z,2,5,"div",12),o(19,"p",13)(20,"small")(21,"span",14),u(22,"\u{1F512}"),i(),u(23," \u05DB\u05DC \u05D4\u05EA\u05E8\u05D5\u05DE\u05D5\u05EA \u05DE\u05D0\u05D5\u05D1\u05D8\u05D7\u05D5\u05EA \u05D1\u05D0\u05DE\u05E6\u05E2\u05D5\u05EA PayPal \u05D5-PayBox. "),i()()()}n&2&&(s(8),O("ngModel",e.donationAmount),s(10),v("ngIf",e.donationStatus))},dependencies:[T,U,F,L,z,N,H,R],styles:[".donation-container[_ngcontent-%COMP%]{padding:2.5rem;margin-top:2rem;background-color:#fff;border-radius:12px;box-shadow:0 10px 20px #0000001a;margin-left:auto;margin-right:auto;text-align:center;font-family:Inter,sans-serif;direction:rtl}.donation-title[_ngcontent-%COMP%]{font-size:2.2rem;color:#2c3e50;margin-bottom:1rem;font-weight:700}.donation-description[_ngcontent-%COMP%]{font-size:1.1rem;color:#555;margin-bottom:2rem;line-height:1.6}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem;text-align:right}.form-label[_ngcontent-%COMP%]{display:block;font-size:1rem;color:#333;margin-bottom:.5rem;font-weight:600}.form-input[_ngcontent-%COMP%]{width:100%;padding:.8rem;border:1px solid #ccc;border-radius:6px;font-size:1.1rem;text-align:right;box-sizing:border-box}.paypal-button-wrapper[_ngcontent-%COMP%]{margin-top:2rem;min-height:50px;display:flex;justify-content:center}.paybox-link-wrapper[_ngcontent-%COMP%]{margin-top:2rem;display:block}.paybox-text[_ngcontent-%COMP%]{font-size:1rem;color:#555;margin-bottom:.8rem}.paybox-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.8rem 1.5rem;background-color:#007bff;color:#fff;border-radius:6px;text-decoration:none;font-weight:700;font-size:1.1rem;transition:background-color .3s ease;width:100%;max-width:250px;margin:0 auto}.paybox-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.paybox-logo[_ngcontent-%COMP%]{height:24px;margin-left:.8rem}@media (min-width: 768px){.paybox-link-wrapper[_ngcontent-%COMP%]{display:none}}.donation-status[_ngcontent-%COMP%]{margin-top:1.5rem;padding:.8rem;border-radius:6px;font-weight:600;font-size:1rem}.donation-status.success[_ngcontent-%COMP%]{background-color:#e6ffe6;color:#28a745;border:1px solid #28a745}.donation-status.error[_ngcontent-%COMP%]{background-color:#ffe6e6;color:#dc3545;border:1px solid #dc3545}.security-note[_ngcontent-%COMP%]{margin-top:2rem;font-size:.85rem;color:#777}.security-icon[_ngcontent-%COMP%]{margin-left:.3rem}"]})};export{q as DonationComponent};
